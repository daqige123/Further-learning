用户数据==》 报文段==》 包==》 幁===》 比特流

### 传输层

### 1. UDP

#### UDP的主要特点（与TCP的不同）

1. udp 是面向无连接，发送数据前不需要建立连接，当然也不用维护那些复杂的连接状态表。(TCP面向连接的)
2. UDP面向报文的, UDP对应用层传下来的数据既不拆分也不合并，一次交付一个完成的报文。这个报文的大小应用程序就决定好了。TCP会将应用数据分割成自己认为最适合发送的数据块（当前网络拥塞窗口值，流量控制窗口值），且TCP面向字节流，按字节去排序端口传来的数据，就是说接受方收到的字节和发送方的发送的字节流要完全一样。
3. UDP支持一对一，一对多， 多对多传输，不是全双工通信。TCP连接只能是两个端口的连接，是全双工通信。
4. UDP 使用尽最大努力交付，即不保证可靠交付，同时也不使用拥塞控制。

### 2. TCP

#### TCP如何保证可靠传输的(不丢失，不重复， 不乱序)

1. 超时重传机制。当tcp发出一个报文段以后，会启动一个定时器，等待目的端确认收到这个报文端，如果不能和即时收到一个确认，将重发这个报文段。（不丢失）

2. TCP对发送的每一个包进行编号，接收方对数据包进行排序，再把有序数据传给应用层（不乱序）

3. TCP接收端会丢弃重复的数据。

4. 校验和：这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。如果检验出来有差错就直接丢弃这个报文段。

5. 流量控制：TCP连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区能接纳

   的我数据。当接收方来不及处理发送方的数据，能提示发送方降低发送的速率，防止包丢失。TCP使用的流量

   控制协议是可变大小的滑动窗口协议。

6. 拥塞控制：当网络拥塞时，减少数据的发送。流量控制是为了让接收方能来得及接收，而拥塞控制是为了降低整个网络的拥塞程度

#### 流量控制

主要是靠滑动窗口来实现流量控制的。流量控制就是说我们要控制发送方发送速率，保证接收方来得及接收。主要做法就是接受方发送确认报文中的窗口字段来控制发送方的发送窗口大小。

#### 拥塞控制

拥塞控制就是为了防止过多的数据一下子注入到网络中。流量控制，他考虑的是两个端到端之间的情况，而拥塞控制考虑的是整个网络数据的传输情况，就是包括路由器，所有主机他们的数据发送情况，是全局性的。拥塞控制就要求TCP发送方同时要维持一个拥塞窗口，这个窗口的大小取决于整个网络的拥塞情况，是动态变化的。所以最终的发送大小是取得流量控制里面的哪个发送窗口大小，和拥塞窗口里面的小的那一个值。

主要方法有：慢开始，拥塞避免，快重传、快开始。





### 2. TCP

#### TCP三次握手 和四次挥手

![image-20210626173539501](C:\Users\24026\AppData\Roaming\Typora\typora-user-images\image-20210626173539501.png)

syn =  1 seq = x 

ACK = 1 seq = y  ack= x+1

ACK = 1  seq = x+1  ack = y+1



##### 为什么要三次握手，两次不行嘛？

如果两次握手就建立了连接，那么如果第一次客服端发送请求的连接没有丢失，而是在某些网络节点长时间滞留了，服务器收到后发送确认收到后，就成功建立一次连接。

如果3次就可以避免这种情况了，a收到b的确认后，但是不会向b发送确认，这样就不会建立新的连接了。

#### 四次挥手

![image-20210627113244827](C:\Users\24026\AppData\Roaming\Typora\typora-user-images\image-20210627113244827.png)

​		FIN = 1 seq = x

​		ACK =1 seq  = y   ack = x+1;

​		ACK = 1 FIN =1 seq=y+n  ack = x+1   A 收到这个b发过来的确认后，进入TIME-WAIT状态， 等到2MSL时间后释放连接

​       ACK = 1 seq = x+1  ack = y+n+1  B收到A 的确认后释放连接。







